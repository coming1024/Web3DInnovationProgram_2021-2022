<!DOCTYPE html>
<html lang="en">
<head>
    <title>MEETING</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            overflow: hidden;
        }
    </style>
</head>

<body>

<script src="js/lib/threeJS/three.js"></script>
<script src="js/lib/threeJS/OrbitControls.js"></script>
<script src="js/lib/threeJS/GLTFLoader.js"></script>

<script src="js/lib/pmLib/MyPMLoader.js"></script>

<script src="js/lib/instancedLib/InstancedGroup.js"></script>
<script src="js/lib/instancedLib/SkinnedMeshController.js"></script>

<script src="js/VideoManager.js"></script>

<script src="js/sceneSet/RoomManager.js"></script>
<script src="js/sceneSet/SeatManager.js"></script>
<script src="js/sceneSet/AvatarManager.js"></script>

<script src="js/playerControl/PlayerControl.js"></script>
<script src="js/playerControl/PreviewManager.js"></script>

<script src="js/ResourceLoader.js"></script>
<script src="js/ParamMeasure.js"></script>
<script src="js/Main.js"></script>
<script src="js/MySocket.js"></script>

<script type="module">


    var myMain = new Main();
    myMain.start();
    //LYZ修改
    let cameraX = 26.5474101;
    let cameraY = 9.609053;
    let cameraZ = 10.9;
    myMain.camera.position.set(cameraX, cameraY, cameraZ);
    myMain.camera.rotation.set(0.0793021902702234, 0.8739098399535151, -0.0608649);
    //LYZ修改
    // myMain.camera.position.set(26.5474101, 9.609053, 10.9);
    // myMain.camera.rotation.set(0.0793021902702234, 0.8739098399535151,  -0.0608649);

    new PlayerControl(myMain.camera);
    window.c = myMain.camera;

    var myRoomManager = new RoomManager(null, myMain.camera);
    myMain.scene.add(myRoomManager.room);
    //LYZ修改
    const geometry = new THREE.BoxGeometry();
    const material = new THREE.MeshBasicMaterial({color: 0x00ff00});
    var group = new THREE.Group()

    socket.onmessage = function (ev) {
        group.traverse(function (obj) {
            console.log(obj.type)
            if (obj.type === 'Mesh') {
                console.log('进来了')
                obj.geometry.dispose();
                obj.material.dispose();
                group.remove(obj);
            }
        })
        myMain.scene.remove(group);
        group.clear();
        var arr = JSON.parse(ev.data)
        console.log(arr)
        for (let i = 0; i < arr.length; i++) {
            const cube = new THREE.Mesh(geometry, material);
            group.add(cube);
            cube.position.setZ(arr[i].z);
            cube.position.setY(arr[i].y);
            cube.position.setX(arr[i].x);
        }
        // console.log("添加")
        myMain.scene.add(group);
    };
    socket.onopen = function (ev) {
        console.log("连接开启onopen");
        const data = {
            x: cameraX,
            y: cameraY,
            z: cameraZ
        }
        socket.send(JSON.stringify(data))
    };
    socket.onclose = function (ev) {
        console.log("连接关闭onclose");

    };
    //LYZ修改

</script>
</body>
</html>
